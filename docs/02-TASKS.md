# Task Backlog — MVP

Задачи атомарные (1–3 ч), без параллельной разработки. Порядок строго последовательный.

---

## Milestone 1 — Скелет и загрузка

### T-001 (done) Инициализация проекта

**Цель:** Готовый скелет SPA (Vite + React + TypeScript) с базовым layout под загрузку, превью и скачивание.

**Входные условия:** Репозиторий с README, Node.js установлен.

**Definition of Done:**
- Проект на Vite + React + TypeScript
- Структура папок: `src/`, `src/components/`, `public/`
- Базовый layout: заголовок, зона под загрузку, зона под превью «до», зона под результат «после», место под кнопку скачивания
- `npm run dev` и `npm run build` выполняются без ошибок

**Тест-критерии:**
- Запуск `npm run dev` — приложение открывается в браузере
- Запуск `npm run build` — сборка успешна

---

### T-002 UI загрузки изображения

**Цель:** Пользователь может загрузить изображение через клик по области или drag-and-drop.

**Входные условия:** T-001 выполнен.

**Definition of Done:**
- Поддержка форматов: JPG, PNG, WebP
- При размере файла > 15 МБ показывается ошибка
- При разрешении > 5000×5000 показывается ошибка
- Реализованы и клик по области, и drag-and-drop

**Тест-критерии:**
- Загрузить маленький JPG — принимается
- Загрузить PNG и WebP — принимаются
- Загрузить файл > 15 МБ — отображается ошибка
- Загрузить изображение с стороной > 5000 px — отображается ошибка

---

### T-003 Превью исходного изображения («Before»)

**Цель:** После загрузки отображается превью загруженного изображения.

**Входные условия:** T-002 выполнен.

**Definition of Done:**
- В зоне «до» отображается загруженное изображение
- Сохранён aspect ratio, изображение вписывается в отведённую область

**Тест-критерии:**
- Загрузить изображение — превью отображается без искажений
- Проверить на портретном и альбомном изображении

---

### T-004 Заглушка результата и кнопка «Download» (stub)

**Цель:** Есть зона под результат и кнопка скачивания; по клику скачивается PNG (пока исходное изображение, конвертированное в PNG).

**Входные условия:** T-003 выполнен.

**Definition of Done:**
- Зона «после» с текстом «Result will appear here» (или эквивалент)
- Кнопка «Download» активна после успешной загрузки изображения
- По клику скачивается файл в формате PNG (содержимое — исходное изображение)

**Тест-критерии:**
- Загрузить изображение — кнопка становится активной
- Нажать «Download» — скачивается один файл .png

---

## Milestone 2 — ML Inference

### T-005 Подключение onnxruntime-web

**Цель:** В проект добавлен и используется `onnxruntime-web` для создания сессии инференса.

**Входные условия:** T-004 выполнен.

**Definition of Done:**
- Пакет `onnxruntime-web` добавлен в зависимости
- В коде импортируется и используется API для создания `InferenceSession` (без загрузки модели — только инициализация окружения)

**Тест-критерии:**
- Сборка без ошибок
- Импорт и вызов API ORT в приложении не приводят к ошибкам в консоли (без загрузки модели)

---

### T-006 Загрузка модели u2netp.onnx

**Цель:** Модель загружается из `/public/models/u2netp.onnx` и кэшируется браузером.

**Входные условия:** T-005 выполнен; файл `u2netp.onnx` размещён в `public/models/`.

**Definition of Done:**
- Модель запрашивается по пути `/models/u2netp.onnx`
- Создаётся `InferenceSession` с загруженной моделью
- Используется стандартный кэш браузера (без лишней логики)

**Тест-критерии:**
- Первая загрузка модели завершается без ошибки
- Время загрузки модели ≤ 7 сек (TECH-SPEC)

---

### T-007 WebGPU и WASM fallback

**Цель:** Инференс выполняется на WebGPU; при недоступности — на WASM.

**Входные условия:** T-006 выполнен.

**Definition of Done:**
- В опциях сессии указаны execution providers: WebGPU (основной), WASM (fallback)
- Сессия создаётся с выбранным провайдером без падения приложения

**Тест-критерии:**
- В браузере с поддержкой WebGPU — используется WebGPU (проверка в консоли/дебаг при необходимости)
- В среде без WebGPU (или при отключении) — приложение не падает, используется WASM

---

### T-008 Препроцессинг: изображение → тензор

**Цель:** Загруженное изображение преобразуется в нормализованный тензор для входа U²-Net с размером стороны в диапазоне 320–480.

**Входные условия:** T-007 выполнен.

**Definition of Done:**
- Реализована функция/модуль: вход — изображение (ImageBitmap или данные изображения), выход — тензор в формате, ожидаемом моделью
- Resize до размера в диапазоне 320–480 (по длинной стороне или фиксированный размер по спецификации)
- Нормализация значений по правилам модели (если указаны в документации U²-Net/ONNX)

**Тест-критерии:**
- Подать тестовое изображение — на выходе тензор корректной формы и типа
- Размер входа соответствует ограничению 320–480

---

### T-009 Inference → маска

**Цель:** Один прогон модели по входному тензору возвращает маску (область объекта).

**Входные условия:** T-008 выполнен.

**Definition of Done:**
- Вызов `session.run()` с выходом модели
- Результат — маска (тензор/массив), пригодная для дальнейшей обработки
- Время одного inference ≤ 2 сек (TECH-SPEC)

**Тест-критерии:**
- Подать изображение — получить маску без ошибки
- Замерить время inference — ≤ 2 сек

---

### T-010 Апскейл маски и композиция в PNG

**Цель:** Маска масштабируется до размера исходного изображения; по маске формируется PNG с прозрачным фоном.

**Входные условия:** T-009 выполнен.

**Definition of Done:**
- Маска апскейлится до размеров исходного изображения
- Исходное изображение комбинируется с маской: область фона — прозрачная
- Результат экспортируется в PNG с альфа-каналом

**Тест-критерии:**
- Загрузить фото, выполнить пайплайн — скачать/получить PNG
- Открыть PNG в редакторе — фон прозрачный, объект виден

---

### T-011 Постобработка маски (feather / blur)

**Цель:** Сглаживание границ маски для уменьшения «жёстких» краёв.

**Входные условия:** T-010 выполнен.

**Definition of Done:**
- К границам маски применяется размытие или feather (по TECH-SPEC)
- В итоговом PNG нет явных ступенчатых артефактов по контуру

**Тест-критерии:**
- Сравнить результат на одном и том же портрете до/после постобработки — края визуально мягче
- Acceptance: «фон удалён без явных дефектов» (PRD) выполняется

---

### T-012 Интеграция пайплайна в UI

**Цель:** Полный сценарий из PRD: загрузка → превью → удаление фона → отображение результата и скачивание PNG.

**Входные условия:** T-011 выполнен.

**Definition of Done:**
- После загрузки изображения пользователь может запустить удаление фона (кнопка или автоматически)
- В зоне «после» отображается результат с прозрачным фоном
- Кнопка «Download» скачивает итоговый PNG (результат сегментации), а не исходник
- Обработка выполняется полностью в браузере

**Тест-критерии:**
- Открыть сайт → загрузить JPG → дождаться обработки → увидеть результат в «после» → нажать Download → открыть PNG: прозрачный фон, объект сохранён
- Повторить для PNG и WebP

---

### T-013 Проверка лимитов и производительности

**Цель:** Соблюдение ограничений PRD и TECH-SPEC по размеру, разрешению и времени выполнения.

**Входные условия:** T-012 выполнен.

**Definition of Done:**
- Файл > 15 МБ — показывается ошибка, обработка не запускается
- Разрешение > 5000×5000 — показывается ошибка, обработка не запускается
- Загрузка модели: ≤ 7 сек
- Inference: ≤ 2 сек
- Полное время обработки одного фото: ≤ 5 сек

**Тест-критерии:**
- Загрузить файл > 15 МБ — ошибка
- Загрузить изображение > 5000×5000 — ошибка
- Замерить: загрузка модели, inference, полный цикл — укладываются в лимиты TECH-SPEC
- Проверка в современном браузере (Chrome/Edge/Firefox) — сценарий из PRD выполняется
